
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Learning sampling pattern with decimation &#8212; MRI-nufft Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'generated/autoexamples/example_learn_samples_multires';</script>
    <link rel="icon" href="../../_static/mri-nufft-icon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Minimal example script" href="example_readme.html" />
    <link rel="prev" title="Animated 3D trajectories" href="example_gif_3D.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/mri-nufft.png" class="logo__image only-light" alt="MRI-nufft Documentation - Home"/>
    <img src="../../_static/mri-nufft.png" class="logo__image only-dark pst-js-only" alt="MRI-nufft Documentation - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    MRI-NUFFT
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>

<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Examples</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="example_2D_trajectories.html">2D Trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_3D_trajectories.html">3D Trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_gif_2D.html">Animated 2D trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_gif_3D.html">Animated 3D trajectories</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Learning sampling pattern with decimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_readme.html">Minimal example script</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_offresonance.html">Off-resonance corrected NUFFT operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_stacked.html">Stacked NUFFT operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_subspace.html">Subspace NUFFT Operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_display_config.html">Trajectory display configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_trajectory_tools.html">Trajectory tools</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="GPU/index.html">GPU Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="GPU/example_density.html">Density Compensation Routines</a></li>
<li class="toctree-l3"><a class="reference internal" href="GPU/example_learn_samples.html">Learn Sampling pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="GPU/example_learn_samples_multicoil.html">Learn Sampling pattern for multi-coil MRI</a></li>
<li class="toctree-l3"><a class="reference internal" href="GPU/example_learn_straight_line_readouts.html">Learn Straight line readout pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="GPU/example_cg.html">Reconstruction with conjugate gradient</a></li>
<li class="toctree-l3"><a class="reference internal" href="GPU/example_fastMRI_UNet.html">Simple UNet model.</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../nufft.html">The NUFFT Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trajectory_gradspec.html">The trajectory binary file specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mrinufft_convention.html">MRI-NUFFT Interfaces Convention</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.html"><code class="docutils literal notranslate"><span class="pre">mrinufft.operators</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.autodiff.html"><code class="docutils literal notranslate"><span class="pre">operators.autodiff</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.autodiff.MRINufftAutoGrad.html">MRINufftAutoGrad</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.base.html"><code class="docutils literal notranslate"><span class="pre">operators.base</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.base.check_backend.html">check_backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.base.get_operator.html">get_operator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.base.list_backends.html">list_backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.base.FourierOperatorBase.html">FourierOperatorBase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.base.FourierOperatorCPU.html">FourierOperatorCPU</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.html"><code class="docutils literal notranslate"><span class="pre">operators.interfaces</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.bart.html"><code class="docutils literal notranslate"><span class="pre">interfaces.bart</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.bart.MRIBartNUFFT.html">MRIBartNUFFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.bart.RawBartNUFFT.html">RawBartNUFFT</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.cufinufft.html"><code class="docutils literal notranslate"><span class="pre">interfaces.cufinufft</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.cufinufft.MRICufiNUFFT.html">MRICufiNUFFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.cufinufft.RawCufinufftPlan.html">RawCufinufftPlan</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.finufft.html"><code class="docutils literal notranslate"><span class="pre">interfaces.finufft</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.finufft.MRIfinufft.html">MRIfinufft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.finufft.RawFinufftPlan.html">RawFinufftPlan</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.gpunufft.html"><code class="docutils literal notranslate"><span class="pre">interfaces.gpunufft</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.gpunufft.make_pinned_smaps.html">make_pinned_smaps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.gpunufft.MRIGpuNUFFT.html">MRIGpuNUFFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.gpunufft.RawGpuNUFFT.html">RawGpuNUFFT</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nfft.html"><code class="docutils literal notranslate"><span class="pre">interfaces.nfft</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nfft.get_fourier_matrix.html">get_fourier_matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nfft.MRInfft.html">MRInfft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nfft.RawPyNFFT.html">RawPyNFFT</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nudft_numpy.html"><code class="docutils literal notranslate"><span class="pre">interfaces.nudft_numpy</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nudft_numpy.get_fourier_matrix.html">get_fourier_matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nudft_numpy.get_implicit_matrix.html">get_implicit_matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nudft_numpy.implicit_type1_ndft.html">implicit_type1_ndft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nudft_numpy.implicit_type2_ndft.html">implicit_type2_ndft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nudft_numpy.MRInumpy.html">MRInumpy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.nudft_numpy.RawNDFT.html">RawNDFT</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.pynufft_cpu.html"><code class="docutils literal notranslate"><span class="pre">interfaces.pynufft_cpu</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.pynufft_cpu.MRIPynufft.html">MRIPynufft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.pynufft_cpu.RawPyNUFFT.html">RawPyNUFFT</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.sigpy.html"><code class="docutils literal notranslate"><span class="pre">interfaces.sigpy</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.sigpy.MRISigpyNUFFT.html">MRISigpyNUFFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.sigpy.RawSigpyNUFFT.html">RawSigpyNUFFT</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.tfnufft.html"><code class="docutils literal notranslate"><span class="pre">interfaces.tfnufft</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.tfnufft.MRITensorflowNUFFT.html">MRITensorflowNUFFT</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.torchkbnufft.html"><code class="docutils literal notranslate"><span class="pre">interfaces.torchkbnufft</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.torchkbnufft.MRITorchKbNufft.html">MRITorchKbNufft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.torchkbnufft.TorchKbNUFFTcpu.html">TorchKbNUFFTcpu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.torchkbnufft.TorchKbNUFFTgpu.html">TorchKbNUFFTgpu</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.utils.html"><code class="docutils literal notranslate"><span class="pre">interfaces.utils</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.utils.gpu_utils.html"><code class="docutils literal notranslate"><span class="pre">utils.gpu_utils</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/mrinufft.operators.interfaces.utils.utils.html"><code class="docutils literal notranslate"><span class="pre">utils.utils</span></code></a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.off_resonance.html"><code class="docutils literal notranslate"><span class="pre">operators.off_resonance</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.off_resonance.get_interpolators_from_fieldmap.html">get_interpolators_from_fieldmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.off_resonance.MRIFourierCorrected.html">MRIFourierCorrected</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.stacked.html"><code class="docutils literal notranslate"><span class="pre">operators.stacked</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.stacked.stacked2traj3d.html">stacked2traj3d</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.stacked.traj3d2stacked.html">traj3d2stacked</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.stacked.MRIStackedNUFFT.html">MRIStackedNUFFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.stacked.MRIStackedNUFFTGPU.html">MRIStackedNUFFTGPU</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.operators.subspace.html"><code class="docutils literal notranslate"><span class="pre">operators.subspace</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.operators.subspace.MRISubspace.html">MRISubspace</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.html"><code class="docutils literal notranslate"><span class="pre">mrinufft.trajectories</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.display.html"><code class="docutils literal notranslate"><span class="pre">trajectories.display</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.display.display_2D_trajectory.html">display_2D_trajectory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.display.display_3D_trajectory.html">display_3D_trajectory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.display.display_gradients.html">display_gradients</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.display.display_gradients_simply.html">display_gradients_simply</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.display.displayConfig.html">displayConfig</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.gradients.html"><code class="docutils literal notranslate"><span class="pre">trajectories.gradients</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.gradients.patch_center_anomaly.html">patch_center_anomaly</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.html"><code class="docutils literal notranslate"><span class="pre">trajectories.maths</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.R2D.html">R2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.Ra.html">Ra</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.Rv.html">Rv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.Rx.html">Rx</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.Ry.html">Ry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.Rz.html">Rz</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.compute_coprime_factors.html">compute_coprime_factors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.generate_fibonacci_circle.html">generate_fibonacci_circle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.generate_fibonacci_lattice.html">generate_fibonacci_lattice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.generate_fibonacci_sphere.html">generate_fibonacci_sphere</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.get_closest_fibonacci_number.html">get_closest_fibonacci_number</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.maths.is_from_fibonacci_sequence.html">is_from_fibonacci_sequence</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.html"><code class="docutils literal notranslate"><span class="pre">trajectories.tools</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.conify.html">conify</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.duplicate_along_axes.html">duplicate_along_axes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.epify.html">epify</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.precess.html">precess</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.prewind.html">prewind</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.radialize_center.html">radialize_center</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.rewind.html">rewind</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.rotate.html">rotate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.shellify.html">shellify</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.stack.html">stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.stack_spherically.html">stack_spherically</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.tools.unepify.html">unepify</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.html"><code class="docutils literal notranslate"><span class="pre">trajectories.trajectory2D</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_cones.html">initialize_2D_cones</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_fibonacci_spiral.html">initialize_2D_fibonacci_spiral</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_lissajous.html">initialize_2D_lissajous</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_polar_lissajous.html">initialize_2D_polar_lissajous</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_propeller.html">initialize_2D_propeller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_radial.html">initialize_2D_radial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_rings.html">initialize_2D_rings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_rosette.html">initialize_2D_rosette</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_sinusoide.html">initialize_2D_sinusoide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_spiral.html">initialize_2D_spiral</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory2D.initialize_2D_waves.html">initialize_2D_waves</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.html"><code class="docutils literal notranslate"><span class="pre">trajectories.trajectory3D</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_annular_shells.html">initialize_3D_annular_shells</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_cones.html">initialize_3D_cones</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_floret.html">initialize_3D_floret</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_golden_means_radial.html">initialize_3D_golden_means_radial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_helical_shells.html">initialize_3D_helical_shells</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_park_radial.html">initialize_3D_park_radial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_phyllotaxis_radial.html">initialize_3D_phyllotaxis_radial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_repi.html">initialize_3D_repi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_seiffert_shells.html">initialize_3D_seiffert_shells</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_seiffert_spiral.html">initialize_3D_seiffert_spiral</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_turbine.html">initialize_3D_turbine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_wave_caipi.html">initialize_3D_wave_caipi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.trajectory3D.initialize_3D_wong_radial.html">initialize_3D_wong_radial</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.html"><code class="docutils literal notranslate"><span class="pre">trajectories.utils</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.check_hardware_constraints.html">check_hardware_constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.compute_gradients_and_slew_rates.html">compute_gradients_and_slew_rates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.convert_gradients_to_slew_rates.html">convert_gradients_to_slew_rates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.convert_gradients_to_trajectory.html">convert_gradients_to_trajectory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.convert_slew_rates_to_gradients.html">convert_slew_rates_to_gradients</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.convert_trajectory_to_gradients.html">convert_trajectory_to_gradients</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.initialize_algebraic_spiral.html">initialize_algebraic_spiral</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.initialize_shape_norm.html">initialize_shape_norm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.initialize_tilt.html">initialize_tilt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.normalize_trajectory.html">normalize_trajectory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.unnormalize_trajectory.html">unnormalize_trajectory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.CaseInsensitiveEnumMeta.html">CaseInsensitiveEnumMeta</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.FloatEnum.html">FloatEnum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.Gammas.html">Gammas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.NormShapes.html">NormShapes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.Packings.html">Packings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.Spirals.html">Spirals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.trajectories.utils.Tilts.html">Tilts</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/mrinufft.density.html"><code class="docutils literal notranslate"><span class="pre">mrinufft.density</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.density.geometry_based.html"><code class="docutils literal notranslate"><span class="pre">density.geometry_based</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.density.geometry_based.cell_count.html">cell_count</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.density.geometry_based.voronoi.html">voronoi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.density.geometry_based.voronoi_unique.html">voronoi_unique</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.density.nufft_based.html"><code class="docutils literal notranslate"><span class="pre">density.nufft_based</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.density.nufft_based.pipe.html">pipe</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.density.utils.html"><code class="docutils literal notranslate"><span class="pre">density.utils</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.density.utils.flat_traj.html">flat_traj</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.density.utils.get_density.html">get_density</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.density.utils.normalize_weights.html">normalize_weights</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/mrinufft.io.html"><code class="docutils literal notranslate"><span class="pre">mrinufft.io</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.io.cfl.html"><code class="docutils literal notranslate"><span class="pre">io.cfl</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.io.cfl.cfl2traj.html">cfl2traj</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.io.cfl.traj2cfl.html">traj2cfl</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.io.nsp.html"><code class="docutils literal notranslate"><span class="pre">io.nsp</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.io.nsp.read_arbgrad_rawdat.html">read_arbgrad_rawdat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.io.nsp.read_trajectory.html">read_trajectory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.io.nsp.write_gradients.html">write_gradients</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.io.nsp.write_trajectory.html">write_trajectory</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.io.siemens.html"><code class="docutils literal notranslate"><span class="pre">io.siemens</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.io.siemens.read_siemens_rawdat.html">read_siemens_rawdat</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.io.utils.html"><code class="docutils literal notranslate"><span class="pre">io.utils</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.io.utils.add_phase_to_kspace_with_shifts.html">add_phase_to_kspace_with_shifts</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/mrinufft.extras.html"><code class="docutils literal notranslate"><span class="pre">mrinufft.extras</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.extras.data.html"><code class="docutils literal notranslate"><span class="pre">extras.data</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.extras.data.get_brainweb_map.html">get_brainweb_map</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.extras.field_map.html"><code class="docutils literal notranslate"><span class="pre">extras.field_map</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.extras.field_map.make_b0map.html">make_b0map</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.extras.field_map.make_t2smap.html">make_t2smap</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.extras.gradient.html"><code class="docutils literal notranslate"><span class="pre">extras.gradient</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.extras.gradient.cg.html">cg</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.extras.sim.html"><code class="docutils literal notranslate"><span class="pre">extras.sim</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.extras.sim.fse_simulation.html">fse_simulation</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.extras.smaps.html"><code class="docutils literal notranslate"><span class="pre">extras.smaps</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.extras.smaps.low_frequency.html">low_frequency</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/mrinufft.extras.utils.html"><code class="docutils literal notranslate"><span class="pre">extras.utils</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/mrinufft.extras.utils.get_smaps.html">get_smaps</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/mrinufft._utils.html"><code class="docutils literal notranslate"><span class="pre">mrinufft._utils</span></code></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/mrinufft._utils.auto_cast.html">auto_cast</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/mrinufft._utils.get_array_module.html">get_array_module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/mrinufft._utils.power_method.html">power_method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/mrinufft._utils.proper_trajectory.html">proper_trajectory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/mrinufft._utils.MethodRegister.html">MethodRegister</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Miscellanneous</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../misc/contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/development.html">Developing MRI-nufft</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Related Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://cea-cosmic.github.io/pysap">PySAP</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cea-cosmic.github.io/ModOpt/">ModOpt</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/paquiteau/brainweb-dl">Brainweb-dl</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/mind-inria/mri-nufft" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mind-inria/mri-nufft/edit/main/generated/autoexamples/example_learn_samples_multires.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mind-inria/mri-nufft/issues/new?title=Issue%20on%20page%20%2Fgenerated/autoexamples/example_learn_samples_multires.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/generated/autoexamples/example_learn_samples_multires.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Learning sampling pattern with decimation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#utils">Utils</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-class">Model class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#state-plotting">State plotting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizer-upscaling">Optimizer upscaling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trajectory-learning">Trajectory learning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initialisation">Initialisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-loop">Training loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-generated-autoexamples-example-learn-samples-multires-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code. or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="learning-sampling-pattern-with-decimation">
<span id="sphx-glr-generated-autoexamples-example-learn-samples-multires-py"></span><h1>Learning sampling pattern with decimation<a class="headerlink" href="#learning-sampling-pattern-with-decimation" title="Link to this heading">#</a></h1>
<p>An example using PyTorch to showcase learning k-space sampling patterns with decimation.</p>
<p>This example showcases the auto-differentiation capabilities of the NUFFT operator
with respect to the k-space trajectory in MRI-nufft.</p>
<p>Hereafter we learn the k-space sample locations <span class="math notranslate nohighlight">\(\mathbf{K}\)</span> using the following cost function:</p>
<div class="math notranslate nohighlight">
\[\mathbf{\hat{K}} =  arg \min_{\mathbf{K}} ||  \mathcal{F}_\mathbf{K}^* D_\mathbf{K} \mathcal{F}_\mathbf{K} \mathbf{x} - \mathbf{x} ||_2^2\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{F}_\mathbf{K}\)</span> is the forward NUFFT operator,
<span class="math notranslate nohighlight">\(D_\mathbf{K}\)</span> is the density compensator for trajectory <span class="math notranslate nohighlight">\(\mathbf{K}\)</span>,
and <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> is the MR image which is also the target image to be reconstructed.</p>
<p>Additionally, in order to converge faster, we also learn the trajectory in a multi-resolution fashion.
This is done by first optimizing x8 times decimated trajectory locations, called control points.
After a fixed number of iterations (5 in this example), these control points are upscaled by a factor of 2.
Note that the NUFFT operator always holds linearly interpolated version of the control points as k-space sampling trajectory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example can run on a binder instance as it is purely CPU based backend (finufft), and is restricted to a 2D single coil toy case.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This example only showcases the auto-differentiation capabilities, the learned sampling pattern
is not scanner compliant as the gradients required to implement it violate the hardware constraints.
In practice, a projection <span class="math notranslate nohighlight">\(\Pi_\mathcal{Q}(\mathbf{K})\)</span> onto the scanner constraints set <span class="math notranslate nohighlight">\(\mathcal{Q}\)</span> is recommended
(see <a class="reference internal" href="#cha-16" id="id1"><span>[Cha+16]</span></a>). This is implemented in the proprietary SPARKLING package <a class="reference internal" href="#cha-22" id="id2"><span>[Cha+22]</span></a>.
Users are encouraged to contact the authors if they want to use it.</p>
</div>
<div class="colab-button">
            <a href="https://colab.research.google.com/github/mind-inria/mri-nufft/blob/gh-pages/examples/generated/autoexamples/example_learn_samples_multires.ipynb" target="_blank">
                <img src="https://colab.research.google.com/assets/colab-badge.svg" 
                alt="Open In Colab"/>
            </a>
        </div>
        <div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">brainweb_dl</span> <span class="k">as</span> <span class="nn">bwdl</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tempfile</span> <span class="k">as</span> <span class="nn">tmp</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageSequence</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="nn">mrinufft</span> <span class="kn">import</span> <span class="n">get_operator</span>
<span class="kn">from</span> <span class="nn">mrinufft.trajectories</span> <span class="kn">import</span> <span class="n">initialize_2D_radial</span>
</pre></div>
</div>
<section id="utils">
<h2>Utils<a class="headerlink" href="#utils" title="Link to this heading">#</a></h2>
<section id="model-class">
<h3>Model class<a class="headerlink" href="#model-class" title="Link to this heading">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While we are only learning the NUFFT operator, we still need the gradient <cite>wrt_data=True</cite> to have all the gradients computed correctly.
See <a class="reference internal" href="#grc23" id="id3"><span>[GRC23]</span></a> for more details.</p>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">inital_trajectory</span><span class="p">,</span>
        <span class="n">img_size</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
        <span class="n">start_decim</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">interpolation_mode</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">inital_trajectory</span><span class="p">[:,</span> <span class="p">::</span><span class="n">start_decim</span><span class="p">]),</span>
            <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_decim</span> <span class="o">=</span> <span class="n">start_decim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_mode</span> <span class="o">=</span> <span class="n">interpolation_mode</span>
        <span class="n">sample_points</span> <span class="o">=</span> <span class="n">inital_trajectory</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">inital_trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span> <span class="o">=</span> <span class="n">get_operator</span><span class="p">(</span><span class="s2">&quot;finufft&quot;</span><span class="p">,</span> <span class="n">wrt_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wrt_traj</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span>
            <span class="n">sample_points</span><span class="p">,</span>
            <span class="n">shape</span><span class="o">=</span><span class="n">img_size</span><span class="p">,</span>
            <span class="n">squeeze_dims</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_size</span> <span class="o">=</span> <span class="n">img_size</span>

    <span class="k">def</span> <span class="nf">_interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traj</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Torch interpolate function to upsample the trajectory&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
            <span class="n">traj</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">scale_factor</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_mode</span><span class="p">,</span>
            <span class="n">align_corners</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to get trajectory, which is interpolated version of control points.&quot;&quot;&quot;</span>
        <span class="n">traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span></a> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log2</span></a><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_decim</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
            <span class="n">traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpolate</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">traj</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">traj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">upscale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upscaling the model.</span>
<span class="sd">        In this step, the number of control points are doubled and interpolated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">),</span>
            <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_decim</span> <span class="o">/=</span> <span class="n">factor</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trajectory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">traj</span>

        <span class="c1"># Simulate the acquisition process</span>
        <span class="n">kspace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="n">adjoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">adj_op</span><span class="p">(</span><span class="n">kspace</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">adjoint</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">adjoint</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="state-plotting">
<h3>State plotting<a class="headerlink" href="#state-plotting" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_state</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">traj</span><span class="p">,</span> <span class="n">recon</span><span class="p">,</span> <span class="n">control_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="c1"># Upper left reference image</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">abs</span></a><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;MR Image&quot;</span><span class="p">)</span>

    <span class="c1"># Upper right trajectory</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">traj</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">control_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">control_points</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;Trajectory&quot;</span><span class="p">,</span> <span class="s2">&quot;Control points&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
        <span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Trajectory&quot;</span><span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>

    <span class="c1"># Down left reconstructed image</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">abs</span></a><span class="p">(</span><span class="n">recon</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Reconstruction&quot;</span><span class="p">)</span>

    <span class="c1"># Down right loss evolution</span>
    <span class="k">if</span> <span class="n">loss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>
        <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">)</span>
        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots_adjust.html#matplotlib.pyplot.subplots_adjust" title="matplotlib.pyplot.subplots_adjust" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span></a><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Save &amp; close</span>
    <span class="k">if</span> <span class="n">save_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.savefig.html#matplotlib.pyplot.savefig" title="matplotlib.pyplot.savefig" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span></a><span class="p">(</span><span class="n">save_name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.close.html#matplotlib.pyplot.close" title="matplotlib.pyplot.close" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">close</span></a><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="optimizer-upscaling">
<h3>Optimizer upscaling<a class="headerlink" href="#optimizer-upscaling" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">upsample_optimizer</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">new_optimizer</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Upsample the optimizer.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">old_group</span><span class="p">,</span> <span class="n">new_group</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">optimizer</span><span class="o">.</span><span class="n">param_groups</span></a><span class="p">,</span> <span class="n">new_optimizer</span><span class="o">.</span><span class="n">param_groups</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">old_param</span><span class="p">,</span> <span class="n">new_param</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">old_group</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">],</span> <span class="n">new_group</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]):</span>
            <span class="c1"># Interpolate optimizer states</span>
            <span class="k">if</span> <span class="n">old_param</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/collections.html#collections.defaultdict" title="collections.defaultdict" class="sphx-glr-backref-module-collections sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">optimizer</span><span class="o">.</span><span class="n">state</span></a><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/collections.html#collections.defaultdict" title="collections.defaultdict" class="sphx-glr-backref-module-collections sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">optimizer</span><span class="o">.</span><span class="n">state</span></a><span class="p">[</span><span class="n">old_param</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><a href="https://docs.python.org/3/library/collections.html#collections.defaultdict" title="collections.defaultdict" class="sphx-glr-backref-module-collections sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">optimizer</span><span class="o">.</span><span class="n">state</span></a><span class="p">[</span><span class="n">old_param</span><span class="p">][</span><span class="n">key</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
                        <span class="n">old_state</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/collections.html#collections.defaultdict" title="collections.defaultdict" class="sphx-glr-backref-module-collections sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">optimizer</span><span class="o">.</span><span class="n">state</span></a><span class="p">[</span><span class="n">old_param</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">old_state</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">new_state</span> <span class="o">=</span> <span class="n">old_state</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">new_state</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
                                <span class="n">old_state</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                <span class="n">scale_factor</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span>
                                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">new_optimizer</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">new_param</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_state</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_optimizer</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">new_param</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/collections.html#collections.defaultdict" title="collections.defaultdict" class="sphx-glr-backref-module-collections sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">optimizer</span><span class="o">.</span><span class="n">state</span></a><span class="p">[</span>
                            <span class="n">old_param</span>
                        <span class="p">][</span><span class="n">key</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">new_optimizer</span>
</pre></div>
</div>
</section>
</section>
<section id="data-preparation">
<h2>Data preparation<a class="headerlink" href="#data-preparation" title="Link to this heading">#</a></h2>
<p>A single image to train the model over. Note that in practice
we would use a whole dataset instead (e.g. fastMRI).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">volume</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.flip.html#numpy.flip" title="numpy.flip" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">flip</span></a><span class="p">(</span><span class="n">bwdl</span><span class="o">.</span><span class="n">get_mri</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;T1&quot;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">volume</span></a><span class="p">[</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float32" title="numpy.float32" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">np</span><span class="o">.</span><span class="n">float32</span></a><span class="p">))[</span><span class="kc">None</span><span class="p">]</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
<p>A basic radial trajectory with an acceleration factor of 8.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">AF</span></a> <span class="o">=</span> <span class="mi">8</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">initial_traj</span></a> <span class="o">=</span> <span class="n">initialize_2D_radial</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">AF</span></a><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#numpy.float32" title="numpy.float32" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">np</span><span class="o">.</span><span class="n">float32</span></a>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="trajectory-learning">
<h2>Trajectory learning<a class="headerlink" href="#trajectory-learning" title="Link to this heading">#</a></h2>
<section id="initialisation">
<h3>Initialisation<a class="headerlink" href="#initialisation" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">initial_traj</span></a><span class="p">,</span> <span class="n">img_size</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/volatile/github-ci-mind-inria/_work/_tool/Python/3.10.15/x64/lib/python3.10/site-packages/mrinufft/_utils.py:94: UserWarning: Samples will be rescaled to [-pi, pi), assuming they were in [-0.5, 0.5)
  warnings.warn(
</pre></div>
</div>
<p>The image obtained before learning the sampling pattern
is highly degraded because of the acceleration factor and simplicity
of the trajectory.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">initial_recons</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plot_state</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">initial_traj</span></a><span class="p">,</span> <span class="n">initial_recons</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_example_learn_samples_multires_001.png" srcset="../../_images/sphx_glr_example_learn_samples_multires_001.png" alt="MR Image, Trajectory, Reconstruction" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/volatile/github-ci-mind-inria/_work/_tool/Python/3.10.15/x64/lib/python3.10/site-packages/mrinufft/_utils.py:94: UserWarning: Samples will be rescaled to [-pi, pi), assuming they were in [-0.5, 0.5)
  warnings.warn(
/volatile/github-ci-mind-inria/_work/_tool/Python/3.10.15/x64/lib/python3.10/site-packages/finufft/_interfaces.py:329: UserWarning: Argument `data` does not satisfy the following requirement: C. Copying array (this may reduce performance)
  warnings.warn(f&quot;Argument `{name}` does not satisfy the following requirement: {prop}. Copying array (this may reduce performance)&quot;)
</pre></div>
</div>
</section>
<section id="training-loop">
<h3>Training loop<a class="headerlink" href="#training-loop" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">losses</span></a> <span class="o">=</span> <span class="p">[]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">image_files</span></a> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span><span class="o">.</span><span class="n">current_decim</span></a> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;steps&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tqdms</span><span class="p">:</span>
        <span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">i</span></a> <span class="ow">in</span> <span class="n">tqdms</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">image</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
            <a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">numpy_loss</span></a> <span class="o">=</span> <span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),)</span>

            <span class="n">tqdms</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span><span class="s2">&quot;loss&quot;</span><span class="p">:</span> <a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">numpy_loss</span></a><span class="p">})</span>
            <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">losses</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">numpy_loss</span></a><span class="p">)</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

            <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="c1"># Clamp the value of trajectory between [-0.5, 0.5]</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
                    <span class="n">param</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="c1"># Generate images for gif</span>
            <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><a href="https://docs.python.org/3/library/tempfile.html#tempfile.NamedTemporaryFile" title="tempfile.NamedTemporaryFile" class="sphx-glr-backref-module-tempfile sphx-glr-backref-type-py-function"><span class="n">tmp</span><span class="o">.</span><span class="n">NamedTemporaryFile</span></a><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.clf.html#matplotlib.pyplot.clf" title="matplotlib.pyplot.clf" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">clf</span></a><span class="p">()</span>
            <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plot_state</span><span class="p">(</span>
                <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">,</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">model</span><span class="o">.</span><span class="n">get_trajectory</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
                <span class="n">out</span><span class="p">,</span>
                <span class="n">model</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
                <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">losses</span></a><span class="p">,</span>
                <span class="n">save_name</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">,</span>
            <span class="p">)</span>
            <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">image_files</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">filename</span></a><span class="p">)</span>
        <span class="k">if</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span><span class="o">.</span><span class="n">current_decim</span></a> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">upscale</span><span class="p">()</span>
            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">upsample_optimizer</span><span class="p">(</span>
                <span class="n">optimizer</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
            <span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/30 [00:00&lt;?, ?steps/s]/volatile/github-ci-mind-inria/_work/_tool/Python/3.10.15/x64/lib/python3.10/site-packages/mrinufft/_utils.py:94: UserWarning: Samples will be rescaled to [-pi, pi), assuming they were in [-0.5, 0.5)
  warnings.warn(
/volatile/github-ci-mind-inria/_work/_tool/Python/3.10.15/x64/lib/python3.10/site-packages/finufft/_interfaces.py:329: UserWarning: Argument `data` does not satisfy the following requirement: C. Copying array (this may reduce performance)
  warnings.warn(f&quot;Argument `{name}` does not satisfy the following requirement: {prop}. Copying array (this may reduce performance)&quot;)
/volatile/github-ci-mind-inria/_work/mri-nufft/mri-nufft/examples/example_learn_samples_multires.py:259: UserWarning: Using a target size (torch.Size([1, 1, 1, 256, 256])) that is different to the input size (torch.Size([1, 1, 256, 256])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
  loss = torch.nn.functional.mse_loss(out, image[None, None])

  0%|          | 0/30 [00:00&lt;?, ?steps/s, loss=(array(0.86704654, dtype=float32),)]/volatile/github-ci-mind-inria/_work/_tool/Python/3.10.15/x64/lib/python3.10/site-packages/mrinufft/operators/autodiff.py:98: UserWarning: Casting complex values to real discards the imaginary part (Triggered internally at ../aten/src/ATen/native/Copy.cpp:308.)
  grad_traj = torch.transpose(torch.sum(grad_traj, dim=1), 0, 1).to(

  3%|         | 1/30 [00:00&lt;00:15,  1.86steps/s, loss=(array(0.86704654, dtype=float32),)]
  3%|         | 1/30 [00:00&lt;00:15,  1.86steps/s, loss=(array(0.5286128, dtype=float32),)]
  7%|         | 2/30 [00:01&lt;00:14,  1.90steps/s, loss=(array(0.5286128, dtype=float32),)]
  7%|         | 2/30 [00:01&lt;00:14,  1.90steps/s, loss=(array(0.36503774, dtype=float32),)]
 10%|         | 3/30 [00:01&lt;00:14,  1.93steps/s, loss=(array(0.36503774, dtype=float32),)]
 10%|         | 3/30 [00:01&lt;00:14,  1.93steps/s, loss=(array(0.4146319, dtype=float32),)]
 13%|        | 4/30 [00:02&lt;00:13,  1.95steps/s, loss=(array(0.4146319, dtype=float32),)]
 13%|        | 4/30 [00:02&lt;00:13,  1.95steps/s, loss=(array(0.30785707, dtype=float32),)]
 17%|        | 5/30 [00:02&lt;00:12,  1.94steps/s, loss=(array(0.30785707, dtype=float32),)]
 17%|        | 5/30 [00:02&lt;00:12,  1.94steps/s, loss=(array(0.32219106, dtype=float32),)]
 20%|        | 6/30 [00:03&lt;00:13,  1.84steps/s, loss=(array(0.32219106, dtype=float32),)]
 20%|        | 6/30 [00:03&lt;00:13,  1.84steps/s, loss=(array(0.34580207, dtype=float32),)]
 23%|       | 7/30 [00:03&lt;00:14,  1.64steps/s, loss=(array(0.34580207, dtype=float32),)]
 23%|       | 7/30 [00:03&lt;00:14,  1.64steps/s, loss=(array(0.3096822, dtype=float32),)]
 27%|       | 8/30 [00:04&lt;00:12,  1.72steps/s, loss=(array(0.3096822, dtype=float32),)]
 27%|       | 8/30 [00:04&lt;00:12,  1.72steps/s, loss=(array(0.29107636, dtype=float32),)]
 30%|       | 9/30 [00:05&lt;00:13,  1.55steps/s, loss=(array(0.29107636, dtype=float32),)]
 30%|       | 9/30 [00:05&lt;00:13,  1.55steps/s, loss=(array(0.28929195, dtype=float32),)]
 33%|      | 10/30 [00:05&lt;00:12,  1.65steps/s, loss=(array(0.28929195, dtype=float32),)]
 33%|      | 10/30 [00:05&lt;00:12,  1.65steps/s, loss=(array(0.27598783, dtype=float32),)]
 37%|      | 11/30 [00:06&lt;00:11,  1.72steps/s, loss=(array(0.27598783, dtype=float32),)]
 37%|      | 11/30 [00:06&lt;00:11,  1.72steps/s, loss=(array(0.27360773, dtype=float32),)]
 40%|      | 12/30 [00:06&lt;00:10,  1.80steps/s, loss=(array(0.27360773, dtype=float32),)]
 40%|      | 12/30 [00:06&lt;00:10,  1.80steps/s, loss=(array(0.2685275, dtype=float32),)]
 43%|     | 13/30 [00:07&lt;00:10,  1.69steps/s, loss=(array(0.2685275, dtype=float32),)]
 43%|     | 13/30 [00:07&lt;00:10,  1.69steps/s, loss=(array(0.25053963, dtype=float32),)]
 47%|     | 14/30 [00:08&lt;00:09,  1.65steps/s, loss=(array(0.25053963, dtype=float32),)]
 47%|     | 14/30 [00:08&lt;00:09,  1.65steps/s, loss=(array(0.23135254, dtype=float32),)]
 50%|     | 15/30 [00:08&lt;00:09,  1.57steps/s, loss=(array(0.23135254, dtype=float32),)]
 50%|     | 15/30 [00:08&lt;00:09,  1.57steps/s, loss=(array(0.24112129, dtype=float32),)]
 53%|    | 16/30 [00:09&lt;00:09,  1.52steps/s, loss=(array(0.24112129, dtype=float32),)]
 53%|    | 16/30 [00:09&lt;00:09,  1.52steps/s, loss=(array(0.23986332, dtype=float32),)]
 57%|    | 17/30 [00:10&lt;00:08,  1.54steps/s, loss=(array(0.23986332, dtype=float32),)]
 57%|    | 17/30 [00:10&lt;00:08,  1.54steps/s, loss=(array(0.22417977, dtype=float32),)]
 60%|    | 18/30 [00:10&lt;00:07,  1.59steps/s, loss=(array(0.22417977, dtype=float32),)]
 60%|    | 18/30 [00:10&lt;00:07,  1.59steps/s, loss=(array(0.21919632, dtype=float32),)]
 63%|   | 19/30 [00:11&lt;00:07,  1.40steps/s, loss=(array(0.21919632, dtype=float32),)]
 63%|   | 19/30 [00:11&lt;00:07,  1.40steps/s, loss=(array(0.20742278, dtype=float32),)]
 67%|   | 20/30 [00:12&lt;00:06,  1.51steps/s, loss=(array(0.20742278, dtype=float32),)]
 67%|   | 20/30 [00:12&lt;00:06,  1.51steps/s, loss=(array(0.20717141, dtype=float32),)]
 70%|   | 21/30 [00:12&lt;00:05,  1.59steps/s, loss=(array(0.20717141, dtype=float32),)]
 70%|   | 21/30 [00:12&lt;00:05,  1.59steps/s, loss=(array(0.19848356, dtype=float32),)]
 73%|  | 22/30 [00:13&lt;00:05,  1.57steps/s, loss=(array(0.19848356, dtype=float32),)]
 73%|  | 22/30 [00:13&lt;00:05,  1.57steps/s, loss=(array(0.18597358, dtype=float32),)]
 77%|  | 23/30 [00:13&lt;00:04,  1.64steps/s, loss=(array(0.18597358, dtype=float32),)]
 77%|  | 23/30 [00:13&lt;00:04,  1.64steps/s, loss=(array(0.18525052, dtype=float32),)]
 80%|  | 24/30 [00:14&lt;00:03,  1.75steps/s, loss=(array(0.18525052, dtype=float32),)]
 80%|  | 24/30 [00:14&lt;00:03,  1.75steps/s, loss=(array(0.17937596, dtype=float32),)]
 83%| | 25/30 [00:14&lt;00:02,  1.80steps/s, loss=(array(0.17937596, dtype=float32),)]
 83%| | 25/30 [00:14&lt;00:02,  1.80steps/s, loss=(array(0.17472246, dtype=float32),)]
 87%| | 26/30 [00:15&lt;00:02,  1.85steps/s, loss=(array(0.17472246, dtype=float32),)]
 87%| | 26/30 [00:15&lt;00:02,  1.85steps/s, loss=(array(0.16732308, dtype=float32),)]
 90%| | 27/30 [00:15&lt;00:01,  1.89steps/s, loss=(array(0.16732308, dtype=float32),)]
 90%| | 27/30 [00:15&lt;00:01,  1.89steps/s, loss=(array(0.1665864, dtype=float32),)]
 93%|| 28/30 [00:16&lt;00:01,  1.93steps/s, loss=(array(0.1665864, dtype=float32),)]
 93%|| 28/30 [00:16&lt;00:01,  1.93steps/s, loss=(array(0.15969816, dtype=float32),)]
 97%|| 29/30 [00:17&lt;00:00,  1.66steps/s, loss=(array(0.15969816, dtype=float32),)]
 97%|| 29/30 [00:17&lt;00:00,  1.66steps/s, loss=(array(0.15472594, dtype=float32),)]
100%|| 30/30 [00:17&lt;00:00,  1.75steps/s, loss=(array(0.15472594, dtype=float32),)]
100%|| 30/30 [00:17&lt;00:00,  1.69steps/s, loss=(array(0.15472594, dtype=float32),)]

  0%|          | 0/30 [00:00&lt;?, ?steps/s]
  0%|          | 0/30 [00:00&lt;?, ?steps/s, loss=(array(0.15260476, dtype=float32),)]
  3%|         | 1/30 [00:00&lt;00:21,  1.32steps/s, loss=(array(0.15260476, dtype=float32),)]
  3%|         | 1/30 [00:00&lt;00:21,  1.32steps/s, loss=(array(0.15010233, dtype=float32),)]
  7%|         | 2/30 [00:01&lt;00:18,  1.49steps/s, loss=(array(0.15010233, dtype=float32),)]
  7%|         | 2/30 [00:01&lt;00:18,  1.49steps/s, loss=(array(0.14741988, dtype=float32),)]
 10%|         | 3/30 [00:01&lt;00:16,  1.61steps/s, loss=(array(0.14741988, dtype=float32),)]
 10%|         | 3/30 [00:01&lt;00:16,  1.61steps/s, loss=(array(0.1448765, dtype=float32),)]
 13%|        | 4/30 [00:02&lt;00:15,  1.65steps/s, loss=(array(0.1448765, dtype=float32),)]
 13%|        | 4/30 [00:02&lt;00:15,  1.65steps/s, loss=(array(0.14455202, dtype=float32),)]
 17%|        | 5/30 [00:03&lt;00:14,  1.76steps/s, loss=(array(0.14455202, dtype=float32),)]
 17%|        | 5/30 [00:03&lt;00:14,  1.76steps/s, loss=(array(0.13923562, dtype=float32),)]
 20%|        | 6/30 [00:03&lt;00:13,  1.82steps/s, loss=(array(0.13923562, dtype=float32),)]
 20%|        | 6/30 [00:03&lt;00:13,  1.82steps/s, loss=(array(0.13722605, dtype=float32),)]
 23%|       | 7/30 [00:04&lt;00:12,  1.84steps/s, loss=(array(0.13722605, dtype=float32),)]
 23%|       | 7/30 [00:04&lt;00:12,  1.84steps/s, loss=(array(0.1342723, dtype=float32),)]
 27%|       | 8/30 [00:04&lt;00:11,  1.84steps/s, loss=(array(0.1342723, dtype=float32),)]
 27%|       | 8/30 [00:04&lt;00:11,  1.84steps/s, loss=(array(0.13274895, dtype=float32),)]
 30%|       | 9/30 [00:05&lt;00:14,  1.44steps/s, loss=(array(0.13274895, dtype=float32),)]
 30%|       | 9/30 [00:05&lt;00:14,  1.44steps/s, loss=(array(0.1312033, dtype=float32),)]
 33%|      | 10/30 [00:06&lt;00:12,  1.56steps/s, loss=(array(0.1312033, dtype=float32),)]
 33%|      | 10/30 [00:06&lt;00:12,  1.56steps/s, loss=(array(0.13059834, dtype=float32),)]
 37%|      | 11/30 [00:06&lt;00:11,  1.65steps/s, loss=(array(0.13059834, dtype=float32),)]
 37%|      | 11/30 [00:06&lt;00:11,  1.65steps/s, loss=(array(0.12819725, dtype=float32),)]
 40%|      | 12/30 [00:07&lt;00:10,  1.77steps/s, loss=(array(0.12819725, dtype=float32),)]
 40%|      | 12/30 [00:07&lt;00:10,  1.77steps/s, loss=(array(0.12721008, dtype=float32),)]
 43%|     | 13/30 [00:07&lt;00:09,  1.87steps/s, loss=(array(0.12721008, dtype=float32),)]
 43%|     | 13/30 [00:07&lt;00:09,  1.87steps/s, loss=(array(0.12574998, dtype=float32),)]
 47%|     | 14/30 [00:08&lt;00:08,  1.94steps/s, loss=(array(0.12574998, dtype=float32),)]
 47%|     | 14/30 [00:08&lt;00:08,  1.94steps/s, loss=(array(0.1241952, dtype=float32),)]
 50%|     | 15/30 [00:08&lt;00:07,  1.94steps/s, loss=(array(0.1241952, dtype=float32),)]
 50%|     | 15/30 [00:08&lt;00:07,  1.94steps/s, loss=(array(0.12223588, dtype=float32),)]
 53%|    | 16/30 [00:09&lt;00:07,  1.99steps/s, loss=(array(0.12223588, dtype=float32),)]
 53%|    | 16/30 [00:09&lt;00:07,  1.99steps/s, loss=(array(0.12121239, dtype=float32),)]
 57%|    | 17/30 [00:09&lt;00:06,  2.03steps/s, loss=(array(0.12121239, dtype=float32),)]
 57%|    | 17/30 [00:09&lt;00:06,  2.03steps/s, loss=(array(0.11902349, dtype=float32),)]
 60%|    | 18/30 [00:10&lt;00:05,  2.07steps/s, loss=(array(0.11902349, dtype=float32),)]
 60%|    | 18/30 [00:10&lt;00:05,  2.07steps/s, loss=(array(0.11780152, dtype=float32),)]
 63%|   | 19/30 [00:10&lt;00:06,  1.79steps/s, loss=(array(0.11780152, dtype=float32),)]
 63%|   | 19/30 [00:10&lt;00:06,  1.79steps/s, loss=(array(0.11655162, dtype=float32),)]
 67%|   | 20/30 [00:11&lt;00:05,  1.89steps/s, loss=(array(0.11655162, dtype=float32),)]
 67%|   | 20/30 [00:11&lt;00:05,  1.89steps/s, loss=(array(0.11569391, dtype=float32),)]
 70%|   | 21/30 [00:11&lt;00:04,  1.97steps/s, loss=(array(0.11569391, dtype=float32),)]
 70%|   | 21/30 [00:11&lt;00:04,  1.97steps/s, loss=(array(0.11424895, dtype=float32),)]
 73%|  | 22/30 [00:12&lt;00:03,  2.03steps/s, loss=(array(0.11424895, dtype=float32),)]
 73%|  | 22/30 [00:12&lt;00:03,  2.03steps/s, loss=(array(0.1132096, dtype=float32),)]
 77%|  | 23/30 [00:12&lt;00:03,  2.04steps/s, loss=(array(0.1132096, dtype=float32),)]
 77%|  | 23/30 [00:12&lt;00:03,  2.04steps/s, loss=(array(0.11162986, dtype=float32),)]
 80%|  | 24/30 [00:13&lt;00:02,  2.07steps/s, loss=(array(0.11162986, dtype=float32),)]
 80%|  | 24/30 [00:13&lt;00:02,  2.07steps/s, loss=(array(0.11079919, dtype=float32),)]
 83%| | 25/30 [00:13&lt;00:02,  2.11steps/s, loss=(array(0.11079919, dtype=float32),)]
 83%| | 25/30 [00:13&lt;00:02,  2.11steps/s, loss=(array(0.10959952, dtype=float32),)]
 87%| | 26/30 [00:13&lt;00:01,  2.13steps/s, loss=(array(0.10959952, dtype=float32),)]
 87%| | 26/30 [00:13&lt;00:01,  2.13steps/s, loss=(array(0.10853799, dtype=float32),)]
 90%| | 27/30 [00:14&lt;00:01,  2.15steps/s, loss=(array(0.10853799, dtype=float32),)]
 90%| | 27/30 [00:14&lt;00:01,  2.15steps/s, loss=(array(0.10743055, dtype=float32),)]
 93%|| 28/30 [00:14&lt;00:00,  2.17steps/s, loss=(array(0.10743055, dtype=float32),)]
 93%|| 28/30 [00:14&lt;00:00,  2.17steps/s, loss=(array(0.10652827, dtype=float32),)]
 97%|| 29/30 [00:15&lt;00:00,  1.79steps/s, loss=(array(0.10652827, dtype=float32),)]
 97%|| 29/30 [00:15&lt;00:00,  1.79steps/s, loss=(array(0.10561012, dtype=float32),)]
100%|| 30/30 [00:16&lt;00:00,  1.79steps/s, loss=(array(0.10561012, dtype=float32),)]
100%|| 30/30 [00:16&lt;00:00,  1.85steps/s, loss=(array(0.10561012, dtype=float32),)]

  0%|          | 0/30 [00:00&lt;?, ?steps/s]
  0%|          | 0/30 [00:00&lt;?, ?steps/s, loss=(array(0.10487418, dtype=float32),)]
  3%|         | 1/30 [00:00&lt;00:16,  1.81steps/s, loss=(array(0.10487418, dtype=float32),)]
  3%|         | 1/30 [00:00&lt;00:16,  1.81steps/s, loss=(array(0.10341767, dtype=float32),)]
  7%|         | 2/30 [00:01&lt;00:15,  1.81steps/s, loss=(array(0.10341767, dtype=float32),)]
  7%|         | 2/30 [00:01&lt;00:15,  1.81steps/s, loss=(array(0.10168627, dtype=float32),)]
 10%|         | 3/30 [00:01&lt;00:16,  1.67steps/s, loss=(array(0.10168627, dtype=float32),)]
 10%|         | 3/30 [00:01&lt;00:16,  1.67steps/s, loss=(array(0.0999157, dtype=float32),)]
 13%|        | 4/30 [00:02&lt;00:15,  1.72steps/s, loss=(array(0.0999157, dtype=float32),)]
 13%|        | 4/30 [00:02&lt;00:15,  1.72steps/s, loss=(array(0.0984189, dtype=float32),)]
 17%|        | 5/30 [00:02&lt;00:14,  1.77steps/s, loss=(array(0.0984189, dtype=float32),)]
 17%|        | 5/30 [00:02&lt;00:14,  1.77steps/s, loss=(array(0.0972532, dtype=float32),)]
 20%|        | 6/30 [00:03&lt;00:15,  1.59steps/s, loss=(array(0.0972532, dtype=float32),)]
 20%|        | 6/30 [00:03&lt;00:15,  1.59steps/s, loss=(array(0.09613352, dtype=float32),)]
 23%|       | 7/30 [00:04&lt;00:14,  1.64steps/s, loss=(array(0.09613352, dtype=float32),)]
 23%|       | 7/30 [00:04&lt;00:14,  1.64steps/s, loss=(array(0.09505253, dtype=float32),)]
 27%|       | 8/30 [00:04&lt;00:12,  1.71steps/s, loss=(array(0.09505253, dtype=float32),)]
 27%|       | 8/30 [00:04&lt;00:12,  1.71steps/s, loss=(array(0.09403138, dtype=float32),)]
 30%|       | 9/30 [00:05&lt;00:13,  1.57steps/s, loss=(array(0.09403138, dtype=float32),)]
 30%|       | 9/30 [00:05&lt;00:13,  1.57steps/s, loss=(array(0.09303587, dtype=float32),)]
 33%|      | 10/30 [00:05&lt;00:11,  1.72steps/s, loss=(array(0.09303587, dtype=float32),)]
 33%|      | 10/30 [00:05&lt;00:11,  1.72steps/s, loss=(array(0.09200649, dtype=float32),)]
 37%|      | 11/30 [00:06&lt;00:10,  1.84steps/s, loss=(array(0.09200649, dtype=float32),)]
 37%|      | 11/30 [00:06&lt;00:10,  1.84steps/s, loss=(array(0.09091684, dtype=float32),)]
 40%|      | 12/30 [00:06&lt;00:09,  1.93steps/s, loss=(array(0.09091684, dtype=float32),)]
 40%|      | 12/30 [00:06&lt;00:09,  1.93steps/s, loss=(array(0.08976055, dtype=float32),)]
 43%|     | 13/30 [00:07&lt;00:08,  2.00steps/s, loss=(array(0.08976055, dtype=float32),)]
 43%|     | 13/30 [00:07&lt;00:08,  2.00steps/s, loss=(array(0.08874091, dtype=float32),)]
 47%|     | 14/30 [00:07&lt;00:07,  2.06steps/s, loss=(array(0.08874091, dtype=float32),)]
 47%|     | 14/30 [00:07&lt;00:07,  2.06steps/s, loss=(array(0.08782169, dtype=float32),)]
 50%|     | 15/30 [00:08&lt;00:07,  2.10steps/s, loss=(array(0.08782169, dtype=float32),)]
 50%|     | 15/30 [00:08&lt;00:07,  2.10steps/s, loss=(array(0.08700931, dtype=float32),)]
 53%|    | 16/30 [00:08&lt;00:06,  2.13steps/s, loss=(array(0.08700931, dtype=float32),)]
 53%|    | 16/30 [00:08&lt;00:06,  2.13steps/s, loss=(array(0.08608636, dtype=float32),)]
 57%|    | 17/30 [00:09&lt;00:06,  2.14steps/s, loss=(array(0.08608636, dtype=float32),)]
 57%|    | 17/30 [00:09&lt;00:06,  2.14steps/s, loss=(array(0.08510467, dtype=float32),)]
 60%|    | 18/30 [00:09&lt;00:05,  2.02steps/s, loss=(array(0.08510467, dtype=float32),)]
 60%|    | 18/30 [00:09&lt;00:05,  2.02steps/s, loss=(array(0.08416025, dtype=float32),)]
 63%|   | 19/30 [00:10&lt;00:06,  1.74steps/s, loss=(array(0.08416025, dtype=float32),)]
 63%|   | 19/30 [00:10&lt;00:06,  1.74steps/s, loss=(array(0.08324701, dtype=float32),)]
 67%|   | 20/30 [00:11&lt;00:06,  1.64steps/s, loss=(array(0.08324701, dtype=float32),)]
 67%|   | 20/30 [00:11&lt;00:06,  1.64steps/s, loss=(array(0.08234854, dtype=float32),)]
 70%|   | 21/30 [00:11&lt;00:05,  1.68steps/s, loss=(array(0.08234854, dtype=float32),)]
 70%|   | 21/30 [00:11&lt;00:05,  1.68steps/s, loss=(array(0.08139667, dtype=float32),)]
 73%|  | 22/30 [00:12&lt;00:04,  1.63steps/s, loss=(array(0.08139667, dtype=float32),)]
 73%|  | 22/30 [00:12&lt;00:04,  1.63steps/s, loss=(array(0.0804868, dtype=float32),)]
 77%|  | 23/30 [00:12&lt;00:03,  1.76steps/s, loss=(array(0.0804868, dtype=float32),)]
 77%|  | 23/30 [00:12&lt;00:03,  1.76steps/s, loss=(array(0.07960066, dtype=float32),)]
 80%|  | 24/30 [00:13&lt;00:03,  1.85steps/s, loss=(array(0.07960066, dtype=float32),)]
 80%|  | 24/30 [00:13&lt;00:03,  1.85steps/s, loss=(array(0.07872592, dtype=float32),)]
 83%| | 25/30 [00:13&lt;00:02,  1.93steps/s, loss=(array(0.07872592, dtype=float32),)]
 83%| | 25/30 [00:13&lt;00:02,  1.93steps/s, loss=(array(0.07789394, dtype=float32),)]
 87%| | 26/30 [00:14&lt;00:02,  2.00steps/s, loss=(array(0.07789394, dtype=float32),)]
 87%| | 26/30 [00:14&lt;00:02,  2.00steps/s, loss=(array(0.07707645, dtype=float32),)]
 90%| | 27/30 [00:14&lt;00:01,  2.04steps/s, loss=(array(0.07707645, dtype=float32),)]
 90%| | 27/30 [00:14&lt;00:01,  2.04steps/s, loss=(array(0.07629781, dtype=float32),)]
 93%|| 28/30 [00:15&lt;00:00,  2.06steps/s, loss=(array(0.07629781, dtype=float32),)]
 93%|| 28/30 [00:15&lt;00:00,  2.06steps/s, loss=(array(0.07554185, dtype=float32),)]
 97%|| 29/30 [00:15&lt;00:00,  2.08steps/s, loss=(array(0.07554185, dtype=float32),)]
 97%|| 29/30 [00:15&lt;00:00,  2.08steps/s, loss=(array(0.07479402, dtype=float32),)]
100%|| 30/30 [00:16&lt;00:00,  1.78steps/s, loss=(array(0.07479402, dtype=float32),)]
100%|| 30/30 [00:16&lt;00:00,  1.83steps/s, loss=(array(0.07479402, dtype=float32),)]

  0%|          | 0/30 [00:00&lt;?, ?steps/s]
  0%|          | 0/30 [00:00&lt;?, ?steps/s, loss=(array(0.07407662, dtype=float32),)]
  3%|         | 1/30 [00:00&lt;00:13,  2.12steps/s, loss=(array(0.07407662, dtype=float32),)]
  3%|         | 1/30 [00:00&lt;00:13,  2.12steps/s, loss=(array(0.0726244, dtype=float32),)]
  7%|         | 2/30 [00:00&lt;00:13,  2.14steps/s, loss=(array(0.0726244, dtype=float32),)]
  7%|         | 2/30 [00:00&lt;00:13,  2.14steps/s, loss=(array(0.07098428, dtype=float32),)]
 10%|         | 3/30 [00:01&lt;00:12,  2.17steps/s, loss=(array(0.07098428, dtype=float32),)]
 10%|         | 3/30 [00:01&lt;00:12,  2.17steps/s, loss=(array(0.06965234, dtype=float32),)]
 13%|        | 4/30 [00:01&lt;00:12,  2.13steps/s, loss=(array(0.06965234, dtype=float32),)]
 13%|        | 4/30 [00:01&lt;00:12,  2.13steps/s, loss=(array(0.0685983, dtype=float32),)]
 17%|        | 5/30 [00:02&lt;00:11,  2.14steps/s, loss=(array(0.0685983, dtype=float32),)]
 17%|        | 5/30 [00:02&lt;00:11,  2.14steps/s, loss=(array(0.0676876, dtype=float32),)]
 20%|        | 6/30 [00:02&lt;00:11,  2.16steps/s, loss=(array(0.0676876, dtype=float32),)]
 20%|        | 6/30 [00:02&lt;00:11,  2.16steps/s, loss=(array(0.06679374, dtype=float32),)]
 23%|       | 7/30 [00:03&lt;00:11,  2.03steps/s, loss=(array(0.06679374, dtype=float32),)]
 23%|       | 7/30 [00:03&lt;00:11,  2.03steps/s, loss=(array(0.06589988, dtype=float32),)]
 27%|       | 8/30 [00:03&lt;00:11,  1.94steps/s, loss=(array(0.06589988, dtype=float32),)]
 27%|       | 8/30 [00:03&lt;00:11,  1.94steps/s, loss=(array(0.06502866, dtype=float32),)]
 30%|       | 9/30 [00:04&lt;00:10,  1.94steps/s, loss=(array(0.06502866, dtype=float32),)]
 30%|       | 9/30 [00:04&lt;00:10,  1.94steps/s, loss=(array(0.06413081, dtype=float32),)]
 33%|      | 10/30 [00:05&lt;00:12,  1.64steps/s, loss=(array(0.06413081, dtype=float32),)]
 33%|      | 10/30 [00:05&lt;00:12,  1.64steps/s, loss=(array(0.06324845, dtype=float32),)]
 37%|      | 11/30 [00:05&lt;00:12,  1.56steps/s, loss=(array(0.06324845, dtype=float32),)]
 37%|      | 11/30 [00:05&lt;00:12,  1.56steps/s, loss=(array(0.06246167, dtype=float32),)]
 40%|      | 12/30 [00:06&lt;00:10,  1.66steps/s, loss=(array(0.06246167, dtype=float32),)]
 40%|      | 12/30 [00:06&lt;00:10,  1.66steps/s, loss=(array(0.06174359, dtype=float32),)]
 43%|     | 13/30 [00:06&lt;00:09,  1.78steps/s, loss=(array(0.06174359, dtype=float32),)]
 43%|     | 13/30 [00:06&lt;00:09,  1.78steps/s, loss=(array(0.06104461, dtype=float32),)]
 47%|     | 14/30 [00:07&lt;00:08,  1.87steps/s, loss=(array(0.06104461, dtype=float32),)]
 47%|     | 14/30 [00:07&lt;00:08,  1.87steps/s, loss=(array(0.06036811, dtype=float32),)]
 50%|     | 15/30 [00:07&lt;00:07,  1.96steps/s, loss=(array(0.06036811, dtype=float32),)]
 50%|     | 15/30 [00:07&lt;00:07,  1.96steps/s, loss=(array(0.05971479, dtype=float32),)]
 53%|    | 16/30 [00:08&lt;00:06,  2.03steps/s, loss=(array(0.05971479, dtype=float32),)]
 53%|    | 16/30 [00:08&lt;00:06,  2.03steps/s, loss=(array(0.05908708, dtype=float32),)]
 57%|    | 17/30 [00:08&lt;00:06,  2.07steps/s, loss=(array(0.05908708, dtype=float32),)]
 57%|    | 17/30 [00:08&lt;00:06,  2.07steps/s, loss=(array(0.05846841, dtype=float32),)]
 60%|    | 18/30 [00:09&lt;00:05,  2.11steps/s, loss=(array(0.05846841, dtype=float32),)]
 60%|    | 18/30 [00:09&lt;00:05,  2.11steps/s, loss=(array(0.0578428, dtype=float32),)]
 63%|   | 19/30 [00:09&lt;00:05,  2.11steps/s, loss=(array(0.0578428, dtype=float32),)]
 63%|   | 19/30 [00:09&lt;00:05,  2.11steps/s, loss=(array(0.0572281, dtype=float32),)]
 67%|   | 20/30 [00:10&lt;00:05,  1.81steps/s, loss=(array(0.0572281, dtype=float32),)]
 67%|   | 20/30 [00:10&lt;00:05,  1.81steps/s, loss=(array(0.05666602, dtype=float32),)]
 70%|   | 21/30 [00:10&lt;00:04,  1.89steps/s, loss=(array(0.05666602, dtype=float32),)]
 70%|   | 21/30 [00:10&lt;00:04,  1.89steps/s, loss=(array(0.05613874, dtype=float32),)]
 73%|  | 22/30 [00:11&lt;00:04,  1.96steps/s, loss=(array(0.05613874, dtype=float32),)]
 73%|  | 22/30 [00:11&lt;00:04,  1.96steps/s, loss=(array(0.05561662, dtype=float32),)]
 77%|  | 23/30 [00:11&lt;00:03,  2.00steps/s, loss=(array(0.05561662, dtype=float32),)]
 77%|  | 23/30 [00:11&lt;00:03,  2.00steps/s, loss=(array(0.05512222, dtype=float32),)]
 80%|  | 24/30 [00:12&lt;00:02,  2.05steps/s, loss=(array(0.05512222, dtype=float32),)]
 80%|  | 24/30 [00:12&lt;00:02,  2.05steps/s, loss=(array(0.05470764, dtype=float32),)]
 83%| | 25/30 [00:12&lt;00:02,  2.10steps/s, loss=(array(0.05470764, dtype=float32),)]
 83%| | 25/30 [00:12&lt;00:02,  2.10steps/s, loss=(array(0.05457507, dtype=float32),)]
 87%| | 26/30 [00:13&lt;00:01,  2.07steps/s, loss=(array(0.05457507, dtype=float32),)]
 87%| | 26/30 [00:13&lt;00:01,  2.07steps/s, loss=(array(0.0563061, dtype=float32),)]
 90%| | 27/30 [00:13&lt;00:01,  1.98steps/s, loss=(array(0.0563061, dtype=float32),)]
 90%| | 27/30 [00:13&lt;00:01,  1.98steps/s, loss=(array(0.09944884, dtype=float32),)]
 93%|| 28/30 [00:14&lt;00:01,  1.92steps/s, loss=(array(0.09944884, dtype=float32),)]
 93%|| 28/30 [00:14&lt;00:01,  1.92steps/s, loss=(array(0.43647137, dtype=float32),)]
 97%|| 29/30 [00:14&lt;00:00,  1.88steps/s, loss=(array(0.43647137, dtype=float32),)]
 97%|| 29/30 [00:14&lt;00:00,  1.88steps/s, loss=(array(0.07823093, dtype=float32),)]
100%|| 30/30 [00:15&lt;00:00,  1.58steps/s, loss=(array(0.07823093, dtype=float32),)]
100%|| 30/30 [00:15&lt;00:00,  1.90steps/s, loss=(array(0.07823093, dtype=float32),)]
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a GIF of all images.</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">imgs</span></a> <span class="o">=</span> <span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">image_files</span></a><span class="p">]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">imgs</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
    <span class="s2">&quot;mrinufft_learn_traj_multires.gif&quot;</span><span class="p">,</span>
    <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">append_images</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">imgs</span></a><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
    <span class="n">optimize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/mrinufft_learn_traj_multires.gif" srcset="../../_images/mrinufft_learn_traj_multires.gif" alt="example learn_samples" class = "sphx-glr-single-img"/></section>
<section id="results">
<h3>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="n">final_recons</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">final_traj</span></a> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_trajectory</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a> <span class="o">=</span> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plot_state</span><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">axs</span></a><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">final_traj</span></a><span class="p">,</span> <span class="n">final_recons</span><span class="p">)</span>
<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_example_learn_samples_multires_002.png" srcset="../../_images/sphx_glr_example_learn_samples_multires_002.png" alt="MR Image, Trajectory, Reconstruction" class = "sphx-glr-single-img"/><p>The learned trajectory above improves the reconstruction quality as compared to
the initial trajectory shown above. Note of course that the reconstructed
image is far from perfect because of the documentation rendering constraints.
In order to improve the results one can start by training it for more than
just 5 iterations per decimation level. Also density compensation should be used,
even though it was avoided here for CPU compliance. Check out
<a class="reference internal" href="GPU/example_learn_samples.html#sphx-glr-generated-autoexamples-gpu-example-learn-samples-py"><span class="std std-ref">Learn Sampling pattern</span></a> to know more.</p>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<div role="list" class="citation-list">
<div class="citation" id="cha-16" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">Cha+16</a><span class="fn-bracket">]</span></span>
<p>N. Chauffert, P. Weiss, J. Kahn and P. Ciuciu, A Projection Algorithm for
Gradient Waveforms Design in Magnetic Resonance Imaging, in
IEEE Transactions on Medical Imaging, vol. 35, no. 9, pp. 2026-2039, Sept. 2016,
doi: 10.1109/TMI.2016.2544251.</p>
</div>
<div class="citation" id="cha-22" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">Cha+22</a><span class="fn-bracket">]</span></span>
<p>G. R. Chaithya, P. Weiss, G. Daval-Frrot, A. Massire, A. Vignaud and P. Ciuciu,
Optimizing Full 3D SPARKLING Trajectories for High-Resolution Magnetic
Resonance Imaging, in IEEE Transactions on Medical Imaging, vol. 41, no. 8,
pp. 2105-2117, Aug. 2022, doi: 10.1109/TMI.2022.3157269.</p>
</div>
<div class="citation" id="grc23" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">GRC23</a><span class="fn-bracket">]</span></span>
<p>Chaithya GR, and Philippe Ciuciu. 2023. Jointly Learning Non-Cartesian
k-Space Trajectories and Reconstruction Networks for 2D and 3D MR Imaging
through Projection Bioengineering 10, no. 2: 158.
<a class="reference external" href="https://doi.org/10.3390/bioengineering10020158">https://doi.org/10.3390/bioengineering10020158</a></p>
</div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (1 minutes 13.118 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-generated-autoexamples-example-learn-samples-multires-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/mind-inria/mri-nufft/gh-pages?urlpath=lab/tree/examples/generated/autoexamples/example_learn_samples_multires.ipynb"><img alt="Launch binder" src="../../_images/binder_badge_logo1.svg" style="width: 150px;" />
</a>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/16f36ca13aac8881292ebccce7b20c09/example_learn_samples_multires.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">example_learn_samples_multires.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/52ae2173be07725f954b8e4e8ae4e193/example_learn_samples_multires.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">example_learn_samples_multires.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/b02f5a1bd2a2a90bd2e08987661dc2c3/example_learn_samples_multires.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">example_learn_samples_multires.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="example_gif_3D.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Animated 3D trajectories</p>
      </div>
    </a>
    <a class="right-next"
       href="example_readme.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Minimal example script</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#utils">Utils</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-class">Model class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#state-plotting">State plotting</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizer-upscaling">Optimizer upscaling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation">Data preparation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trajectory-learning">Trajectory learning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initialisation">Initialisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-loop">Training loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By MRI-NUFFT Contributors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2022, MRI-NUFFT Contributors.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>